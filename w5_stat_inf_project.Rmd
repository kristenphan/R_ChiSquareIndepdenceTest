---
title: "Statistical inference with the GSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Assignment description
This is the capstone project by Kristen Phan for Duke University's Inferential Statistics course ([Course URL](https://www.coursera.org/learn/inferential-statistics-intro)).

The project consists of 4 parts:
<br /> 
__1. Data:__ Summarize background information on the dataset including its generalizability and causality
<br/>
__2. Research question:__ Formulate a research question pertaining to the dataset
<br />
__3. Exploratory Data Analysis:__ Perform EDA on the dataset
<br />
__4. Inference:__ Perform statistical inference (confidence interval and hypothesis testing) on the dataset to address the research question set forth

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(statsr)
```

### Load data

```{r load-data}
load("gss.Rdata")
```



* * *

## Part 1: Data

__1. Background:__
<br />
[Excerpted from the [GSS project description](http://gss.norc.org/About-The-GSS)]
<br />
Since 1972, the General Social Survey (GSS) has been monitoring societal change and studying the growing complexity of American society. The GSS aims to gather data on contemporary American society in order to monitor and explain trends and constants in attitudes, behaviors, and attributes; to examine the structure and functioning of society in general as well as the role played by relevant subgroups; to compare the United States to other societies in order to place American society in comparative perspective and develop cross-national models of human society; and to make high-quality data easily accessible to scholars, students, policy makers, and others, with minimal cost and waiting.
<br />
GSS questions cover a diverse range of issues including national spending priorities, marijuana use, crime and punishment, race relations, quality of life, confidence in institutions, and sexual behavior.More information on the dataset [here.](https://d3c33hcgiwev3.cloudfront.net/_8abbe344133a7a8c98cfabe01a5075c2_gss.html?Expires=1590451200&Signature=Bq4F4KzenjEE1AbRdnUIV5pmNNrsgmhfnkmaAHEb3Nb~4wvkHMjUsFK6UostkpNd-jAkFpw7FCzNlgAqnnpSizAv0mpsk5X5UgFr3G7KjY36gSnDm61M1r0q0HeoGL-5U2~BDkgLwc~vvexmJIeL2ZXOz~GXC8nW-5ruaAS5m14_&Key-Pair-Id=APKAJLTNE6QMUY6HBC5A)
<br />
<br />

__2. Generalizability:__
<br />
According to [Appendix A](http://gss.norc.org/DOCUMENTS/CODEBOOK/A.pdf) Sampling Design and Weighting, the study deploys multi-stage, random cluster sampling. However, the most recent response rate documented is 61.3% in 2016 ([source](http://gss.norc.org/Documents/other/Response%20rates.pdf)). Therefore, the generalizability of the study is limited due to possible non-response sampling bias. <br />  

__3. Causality:__
<br />
Because this is an observational study, there was no random assignment. As the result, we can only make inference about association, not causality, from the dataset. 
<br />

* * *

## Part 2: Research question

Is there a correlation betweenreligous engagement and financial satisfaction for respondents who identified themselves as middle class? 
<br />
Religous engagement is measured by how often the respondents attend religous services (low-med-high engagement). Financial satisfaction is measured by the proportion of respondents who claimed to be satisfied with their present satisfaction.
<br />
<br />

* * *

## Part 3: Exploratory data analysis

First, we filter out data pertaining to religious engagement ('attend'), financial satisfaction ('satfin'), social classes ('class').

```{r filter-data}
reli_satfin <- gss %>% filter(!is.na(satfin), 
                                !is.na(attend), 
                                class == "Middle Class") %>%  # filter the target class: middle class
                        select(attend, sat_fin = satfin)
str(reli_satfin)
summary(reli_satfin$attend)
```

Next, we create a new variable called Religious Engagement ('relieng') to categorize respondents based on how often they attend religous services:
<br />
    1. Low engagement: never, lt once a year, or once a year attend religous services
    <br />
    2. Medium enagement: several times a year, once a month, or 2-3x a month
    <br />
    3. High engagement: nearly every week, every week, more than once a week
    <br />
    <br />

```{r rank-religous-engagement}
low <- c("Never", "Lt Once A Year", "Once A Year")
med <- c("Sevrl Times a Yr", "Once A Month", "2-3X A Month")
reli_satfin <- reli_satfin %>% mutate(reli_eng = ifelse(attend %in% low, 
                                                        "low", 
                                                        ifelse(attend %in% med, "med", "high")))

reli_satfin %>% group_by(reli_eng) %>%
                summarise(count = n(), percentage = round(count/nrow(reli_satfin)*100, digits = 0))
```

As shown in the table, the majority of middle-class respondents highly engage in religous services. 
<br />
In the dataset, respondents were asked if they were "Satisfied", "More Or Less", or "Not At All Satisfied" with their current financial situation. In this analysis, we will simplify the reponses by marking "More Or Less" and "Not At All Satisfied" as "Not Satisfied".

```{r}
reli_satfin <- reli_satfin %>% mutate(sat = ifelse(sat_fin == "Satisfied", "satisfied", "unsatisfied"))
reli_satfin %>% group_by(sat) %>%
                summarise(count = n())
```

Now we begin the visualize the distribution of middle-class repondents who are satisfied with their current financial situation across different levels of religous engagement. 

```{r plot-religous-engagement-vs-financial-satisfaction}
reli_eng_l <- c(rep("high",2), rep("med",2), rep("low",2))
sat_fin_l <- c(rep(c("satisfied", "unsatisfied"),3))

high_sat_count <- nrow(subset(reli_satfin, reli_eng == "high" & sat == "satisfied"))
high_notsat_count <- nrow(subset(reli_satfin, reli_eng == "high" & sat == "unsatisfied"))

med_sat_count <- nrow(subset(reli_satfin, reli_eng == "med" & sat == "satisfied"))
med_notsat_count <- nrow(subset(reli_satfin, reli_eng == "med" & sat == "unsatisfied"))

low_sat_count <- nrow(subset(reli_satfin, reli_eng == "low" & sat == "satisfied"))
low_notsat_count <- nrow(subset(reli_satfin, reli_eng == "low" & sat == "unsatisfied"))

value_l <- c(high_sat_count, high_notsat_count, med_sat_count, med_notsat_count, low_sat_count, low_notsat_count)

df <- data.frame(reli_eng_l, sat_fin_l, value_l)

ggplot(data = df, aes(x = reli_eng_l, y = value_l)) +
  geom_col(aes(fill = sat_fin_l), width = 0.7) +
  #geom_text(aes(label =value_l, group =sat_fin_l), color = "white") + 
  geom_text(size = 3, position = position_stack(vjust = 0.7), label = value_l, color = "white") +
  labs(title = "Financial Satisfaction Among Respondents at Different Levels of Religious Engagement", 
        x = "Levels of Religous Engagement", y = "Percentage") +
  theme(plot.title = element_text(size=10)) + 
  theme(legend.title = element_blank())

```

To validate whether there is a correlation between religious engagement and financial satisfaction, we are moving on to performing statistical inference.
<br />

* * *

## Part 4: Inference
<br />

# Hypotheses
Null hypothesis Ho: Religous engagement and financial satisfaction are independent  
<br />
Alternative hypothesis Ha: Religous engagement and financial satisfaction are dependent 
<br />
<br />

# Inferential method
In our inferential analysis, we aim to answer whether the respondents' religous engagement and financial statisfaction are indepdent using chi-square independence test. Religous engagement is measured as low-med-high based on how often the respondents attend religous services. Financial satisfaction is calculated as the proportion of respondents who are satisfied with their current financial situation.  
<br />
Because the respondents' social classes might impose confouding effects on their financial satisfaction, the analysis is limited to the respondents who identified themselves as middle class. 
<br />
The underlying rationale behind this inference is that some people might find comfort and encouragement from their religion, which then affects their perspective and life satisfaction, including financial satisfaction. It is important to emphasize that this study does not infer causation, only correlation. In other words, in no way the results of this study infer that high religous engagement leads to (or causes) high financial satisfaction.  
<br />
Last but not least, we will set alpha = 5% as our significance level.
<br />
<br />

# Check conditions
1. Independence:
<br />
It is safe to assume that all observations are independent of each other. 
<br />

2. Sample size:
<br />
For each level of religious engagement, we all have more than 5 expected cases.

```{r check-sample-size-condition}
p_hat <- sum(reli_satfin$sat == "satisfied") / nrow(reli_satfin) # proportion of middle-class respondents who are satisfied with their current financial situation in the sample

chisq_df <- reli_satfin %>% group_by(reli_eng) %>%
                        summarise(n_respdents = n(), 
                                  obs_sat = sum(sat == "satisfied")) %>%
                        mutate(expected_sat = round(p_hat * n_respdents, digits = 0), 
                               obs_unsat = n_respdents - obs_sat, 
                               expected_unsat = n_respdents - expected_sat)
chisq_df 
```
Since both conditions are met, we now move on to performing the chi-square test.
<br />

# Perform inference

Now we calculate chi-square statistic, degree of freedom (df), and p-value
```{r calculate-chi-square}
chisq <- sum((chisq_df$obs_sat - chisq_df$expected_sat)**2 / chisq_df$expected_sat) + sum((chisq_df$obs_unsat - chisq_df$expected_unsat)**2 / chisq_df$expected_unsat)

chisq

```

```{r calculate-df}
df <- (length(chisq_df$reli_eng) - 1) * (length(c("satisfied", "unsatisfied")) - 1)
df
```

```{r calculate-p-value}
pval <- pchisq(chisq, df, lower.tail = FALSE)
pval
```



# Interpret results

Because pval < alpha (5%), we reject the null hypothesis. The data provides convincing evidence that religous engagement and financial satisfaction are correlated.
<br />
<br />
<br />
<br />
<br />
